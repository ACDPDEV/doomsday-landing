<button
    id="volume-toggle"
    class="w-12"
    aria-pressed="false"
    title="Activar sonido"
>
    <img src="/assets/icons/volume_off.svg" alt="Volume" class="w-5 h-5" />
</button>

<audio id="bg-audio" src="/assets/audio/clock_sound.mp3" loop muted autoplay
></audio>

<script>
    const $ = (s) => document.querySelector(s);
    const volumeToggle = $("#volume-toggle");
    const audio = $("#bg-audio");
    let isMuted = true;

    const updateButton = () => {
        const img = volumeToggle.querySelector("img");
        if (img)
            img.src = isMuted
                ? "/assets/icons/volume_off.svg"
                : "/assets/icons/volume.svg";
        volumeToggle.setAttribute("aria-pressed", String(!isMuted));
        volumeToggle.title = isMuted ? "Activar sonido" : "Silenciar";
    };

    audio?.play().catch(() => {});

    volumeToggle?.addEventListener("click", async () => {
        if (!audio) return;
        isMuted = !isMuted;
        audio.muted = isMuted;
        if (!isMuted) {
            try {
                await audio.play();
            } catch (err) {
                console.warn("Reproducción bloqueada hasta interacción:", err);
            }
        }
        updateButton();
    });

    updateButton();
</script>
